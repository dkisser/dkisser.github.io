# 前言

gRPC的大致功能点相信大家一定已经有些了解。但是，在日常开发中我们很少会使用原生的gRPC，我们期望是的能够将gRPC集成到现有应用的开发环境中。这篇文章会围绕如何以简单的方式将gRPC集成到SpringBoot展开讲解。

# 环境

* 操作系统：Windowns
* JDK版本：1.8
* 编辑工具：IntelliJ IDEA Community Edition 2021.1.2 x64

#选型

目前开源切比较热门的grpc和SpringBoot整合框架有两种可选方案。分别是[LogNet](https://github.com/LogNet/grpc-spring-boot-starter) 和 [yidongnan](https://github.com/yidongnan/grpc-spring-boot-starter) 。**（这两者稍微有些区别，在附录中我会有个对比）**
这里我使用后者作为demo演示。

## 解决的问题

服务的自动注册和发现问题

### LogNet 与 yidongnan

|  | yidongnan | LogNet | 说明 |
| - | - | - | - |
| 协议 | MIT | Apache | 没有太大区别 |
| 服务注册 | 有 | 有 |  |
| 服务发现 | 有 | 无 | yidongnan已经将服务发现和gRPC原生的SLB功能做了集成，而使用LogNet并没有这么便利 |
| 可扩展性 | 强 | 稍弱 | yidongnan本身基于SpringCloud底座，LogNet中并不是所有功能都是和SpringCloud整合，比如：服务注册这些模型就没有使用SpringCloud |

当然，LogNet还有异常的全局控制、事务处理、spring boot validation、spring cloud stream这些功能的支持，所以从功能丰富度这方面上讲LogNet还是有点优势的。**具体方案选型需要结合实际项目，本着够用、适当超前的原则就好。**


### 踩坑笔记

2.

Client端默认设置的是密文，必须要设置TLS证书。当然也可以使用文本传输，但是生产环境不建议。[客户端安全配置传送门](https://yidongnan.github.io/grpc-spring-boot-starter/zh-CN/client/security.html#authentication)
> 文本传输配置：grpc.client.[serviceName].negotiationType=PLAINTEXT

3. 若不集成SpringCloud-Discovery则不能使用注册中心做服务发现，只能固定配置,例如：
   grpc.client.\[serviceName\].address: static://localhost:9090

``` java
 /**
     * Sets the target address uri for the channel. The target uri must be in the format:
     * {@code schema:[//[authority]][/path]}. If nothing is configured then the name of the client will be used along
     * with the default scheme. We recommend explicitly configuring the scheme used for the address resolutions such as
     * {@code dns:/}.
     *
     * <p>
     * <b>Examples</b>
     * </p>
     *
     * <ul>
     * <li>{@code static://localhost:9090} (refers to exactly one IPv4 or IPv6 address, dependent on the jre
     * configuration, it does not check whether there is actually someone listening on that network interface)</li>
     * <li>{@code static://10.0.0.10}</li>
     * <li>{@code static://10.0.0.10,10.11.12.11}</li>
     * <li>{@code static://10.0.0.10:9090,10.0.0.11:80,10.0.0.12:1234,[::1]:8080}</li>
     * <li>{@code dns:/localhost (might refer to the IPv4 or the IPv6 address or both, dependent on the system
     * configuration, it does not check whether there is actually someone listening on that network interface)}</li>
     * <li>{@code dns:/example.com}</li>
     * <li>{@code dns:/example.com:9090}</li>
     * <li>{@code dns:///example.com:9090}</li>
     * <li>{@code discovery:/foo-service}</li>
     * <li>{@code discovery:///foo-service}</li>
     * <li>{@code unix:<relative-path>} (Additional dependencies may be required)</li>
     * <li>{@code unix://</absolute-path>} (Additional dependencies may be required)</li>
     * </ul>
     *
     * @param address The string representation of an uri to use as target address or null to use a fallback.
     *
     * @see <a href="https://github.com/grpc/grpc/blob/master/doc/naming.md">gRPC Name Resolution</a>
     * @see NameResolverProvider
     */
```
